# sqltospreadsheets
## О чем это:

Для того, чтобы снизить рутинную нагрузку на технически грамотных людей вообще и разработчиков в частности — нам нужен сервис, который обладает следующей функциональностью:

- Позволяет выполнять sql-запросы и складывать результат в Google Spreadsheets в заранее определенную для каждого sql-запроса папку;
- Не позволяет выполнять запросы, модифицирующие данные — UPDATE, INSERT, DELETE и прочие;
- Позволяет параметризовать sql-запросы. Т.е. в написанном запросе используются переменные, на основании списка этих переменных генерируется форма, в которой пользователь может заполнить нужные поля. У переменных может быть тип, в зависимости от которого элемент формы меняется (для начала можно ограничиться датой — `input type=text` меняется на виджет с календариком);
- Позволяет индивидуально или на основе групповых прав настраивать доступ пользователей к каждому запросу — помимо собственно доступа к форме "заполнить параметры и запустить запрос" это должно автоматически расшаривать (или снимать шару) соответствующие папки соответствующим пользователям (e-mail есть у каждого пользователя);
- Позволяет задать расписание для каждого запроса, по которому он будет параметризоваться (для типа "дата" нужно предусмотреть возможность параметризовать относительно текущей даты) и запускаться без участия человека. Возможность настраивать расписание должна быть отдельным правом пользователя или группы.

## Без этих интерфейсов будет сложно пользоваться системой:

- CRUD для источников данных (реквизиты доступа к бд). Возможность создавать, редактировать и удалять источники данных должна быть отдельным правом пользователя или группы;
- CRUD для sql-запросов (выбор источника данных, запрос, выбор папки в Google Drive, куда экспортятся результаты). Возможность создавать, редактировать и удалять запросы должна быть отдельным правом пользователя или группы;

## Что нужно понимать об окружении:

- Сервис будет работать в production, завернутый в docker-контейнер;
- Списком пользователями управляет внешний сервис, дающий наружу OAuth. Этот сервис не управляет группами и правами пользователей;
- Мы регулярно таким образом выгружаем запросы по несколько сотен тысяч строк, а это значит, что:
  - Делать это внутри какого-нибудь php-fpm по сабмиту — не самая здравая идея. Просится отложенное выполнение задач в фоне;
  - Они легко упираются в лимит Google Spreadsheets (2 млн ячеек) — надо уметь выгружать полученный массив данных, разбивая его на несколько файлов.
